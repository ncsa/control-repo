---
version: 5

defaults:
  datadir: "data"

hierarchy:
  - name: "Secrets from Vault"
    data_hash: "vault_hiera_hash"
    uris:
      - "https://asd-vault1.internal.ncsa.edu:8200/v1/control-repo/data/nodes/%{fqdn}"  # Node specific secrets
      - "https://asd-vault1.internal.ncsa.edu:8200/v1/control-repo/data/common"         # Secrets common to all nodes
    options:
      version: "v2"
      token_file: "/etc/puppetlabs/puppetserver/token/vault.token"
      ca_trust: "/etc/puppetlabs/puppet/ssl/certs/ca.pem"
  - name: "Yaml backend"
    data_hash: "yaml_data"
    paths:
      - "nodes/%{trusted.certname}.yaml"
      - "site/%{site}/cluster/%{cluster}.yaml"
      - "site/%{site}.yaml"
      - "role/%{role}.yaml"
      - "common.yaml"
